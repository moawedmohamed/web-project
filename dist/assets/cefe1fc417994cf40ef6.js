let allProducts=[];async function fetchAndDisplayProducts(){try{const t=await fetch("https://fakestoreapi.com/products");if(!t.ok)throw new Error(`Failed to fetch: ${t.status}`);allProducts=await t.json(),createFilterSwiper(getUniqueCategories(allProducts)),displayProducts(allProducts)}catch(t){console.error("Error:",t),document.getElementById("product-list").innerHTML='<p class="product-error">Failed to load products. Refresh the page.</p>'}}function getUniqueCategories(t){return["all",...new Set(t.map((t=>t.category)))]}function createFilterSwiper(t){const e=document.getElementById("filter-buttons");e.innerHTML='\n    <div class="filter-swiper">\n      <div class="swiper-wrapper"></div>\n    </div>\n  ';const r=e.querySelector(".swiper-wrapper");t.forEach(((t,a)=>{const o=document.createElement("div");o.className="swiper-slide",o.innerHTML=`\n      <button class="filter-btn${0===a?" active":""}">\n        ${t[0].toUpperCase()+t.slice(1)}\n      </button>\n    `;const n=o.querySelector("button");n.onclick=()=>{e.querySelectorAll(".filter-btn").forEach((t=>t.classList.remove("active"))),n.classList.add("active"),filterByCategory(t)},r.appendChild(o)})),setTimeout((()=>{new Swiper(".filter-swiper",{slidesPerView:"auto",spaceBetween:15,centeredSlides:!0,loop:!1})}),100)}function filterByCategory(t){displayProducts("all"===t?allProducts:allProducts.filter((e=>e.category===t)))}function displayProducts(t){const e=document.getElementById("product-list");e.classList.add("fade-out"),setTimeout((()=>{if(e.innerHTML="",0===t.length)e.innerHTML='<p class="product-error">No products found in this category.</p>';else{const r=JSON.parse(localStorage.getItem("cart"))||[];t.forEach((t=>{const a=r.some((e=>e.id===t.id)),o=createProductCard(t,a);e.appendChild(o);const n=o.querySelector(".btn-cart");t.rating.count>0&&n.addEventListener("click",(()=>{a||addToCart(t)}))}))}e.classList.remove("fade-out")}),300)}function createProductCard(t,e){const r=document.createElement("div");return r.className="card-product",r.innerHTML=`\n<a href="product-details.html?id=${t.id}" style="display: inline-block;">\n  <img class="product-img" src="${t.image}" alt="${t.title}" />\n</a>    <h3 class="product-title">${t.title.split(" ").slice(0,4).join(" ")}</h3>\n    <div class="product-info">\n      <p class="product-price">$${t.price.toFixed(2)}</p>\n      <div class="product-rating">\n        ${generateStarsSVG(t.rating.rate)} (${t.rating.count})\n      </div>\n      <button class="btn-cart" ${0===t.rating.count?"disabled":""} \n              data-id="${t.id}" ${e?"disabled":""}>\n        <span class="btn-cart-icon">\n          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="icon-bag">\n            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 1 0-7.5 0v4.5m11.356-1.993 1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 0 1-1.12-1.243l1.264-12A1.125 1.125 0 0 1 5.513 7.5h12.974c.576 0 1.059.435 1.119 1.007ZM8.625 10.5a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm7.5 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"/>\n          </svg>\n        </span>\n        ${0===t.rating.count?"Unavailable":e?"Added to Cart":"Add to Cart"}\n      </button>\n    </div>\n  `,r}function updateCartCount(){const t=(JSON.parse(localStorage.getItem("cart"))||[]).reduce(((t,e)=>t+e.quantity),0),e=document.getElementById("cart-count");e&&(e.textContent=t,e.style.display=t>0?"block":"none")}function addToCart(t){let e=JSON.parse(localStorage.getItem("cart"))||[];const r=e.find((e=>e.id===t.id));r?r.quantity+=1:e.push({...t,quantity:1}),localStorage.setItem("cart",JSON.stringify(e)),updateButtonState(t.id,!0),updateCartCount()}function addRemoveListeners(){document.querySelectorAll(".remove-item").forEach((t=>{t.addEventListener("click",(()=>{const e=JSON.parse(localStorage.getItem("cart"))||[],r=t.dataset.index,a=e[r];e.splice(r,1),localStorage.setItem("cart",JSON.stringify(e)),updateButtonState(a.id,!1),displayCartItems()}))}))}function updateButtonState(t,e){document.querySelectorAll(`.btn-cart[data-id="${t}"]`).forEach((t=>{t.textContent=e?"Added to Cart":"Add to Cart",t.disabled=e,e||t.removeAttribute("disabled")}))}function generateStarsSVG(t){const e=Math.floor(t),r=t%1>=.5,a=5-e-(r?1:0);let o="";for(let t=0;t<e;t++)o+='<svg class="star-icon full-star" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87L18.18 22 12 18.56 5.82 22 7 14.14l-5-4.87 6.91-1.01L12 2z"/></svg>';r&&(o+='<svg class="star-icon half-star" viewBox="0 0 24 24" fill="currentColor"><defs><linearGradient id="half"><stop offset="50%" stop-color="currentColor"/><stop offset="50%" stop-color="transparent"/></linearGradient></defs><path fill="url(#half)" d="M12 2l3.09 6.26L22 9.27l-5 4.87L18.18 22 12 18.56 5.82 22 7 14.14l-5-4.87 6.91-1.01L12 2z"/></svg>');for(let t=0;t<a;t++)o+='<svg class="star-icon empty-star" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M12 2l3.09 6.26L22 9.27l-5 4.87L18.18 22 12 18.56 5.82 22 7 14.14l-5-4.87 6.91-1.01L12 2z"/></svg>';return o}window.addEventListener("DOMContentLoaded",(()=>{fetchAndDisplayProducts(),updateCartCount()}));